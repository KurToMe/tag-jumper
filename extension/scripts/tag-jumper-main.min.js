var DomParser,ElementArticulator,GameUi,tjump,__bind=function(e,t){return function(){return e.apply(t,arguments)}};tjump={},tjump.overlay=document.createElement("div"),tjump.overlay.id="main-overlay",tjump.overlay.className+="overlay",tjump.canvas=document.createElement("canvas"),tjump.canvas.id="main-canvas",tjump.canvas.className+="canvas",tjump.overlay.appendChild(tjump.canvas),tjump.ctx=tjump.canvas.getContext("2d"),document.body.appendChild(tjump.overlay),tjump.SCALE=32,tjump.FRAME_RATE=1/60,tjump.VELOCITY_ITERATIONS=10,tjump.POSITION_ITERATIONS=10,tjump.GRAVITY=new Box2D.Common.Math.b2Vec2(0,0),tjump.getWidth=function(){return tjump.canvas.offsetWidth},tjump.getHeight=function(){return tjump.canvas.offsetHeight},tjump.scaleToPhys=function(e){return e/tjump.SCALE},tjump.scaleVecToPhys=function(e){return e.Multiply(1/tjump.SCALE),e},tjump.scaleToScreen=function(e){return e*tjump.SCALE},tjump.applyXForce=function(e,t){var n,r,i;return n=Box2D.Common.Math.b2Vec2,r=e.GetPosition(),i=new n(t,0),e.ApplyForce(i,r)},tjump.applyYForce=function(e,t){var n,r,i;return n=Box2D.Common.Math.b2Vec2,r=e.GetPosition(),i=new n(0,t),e.ApplyForce(i,r)},tjump.isBodyInContact=function(e,t){var n,r;return n=e.GetFixtureA().GetBody(),r=e.GetFixtureB().GetBody(),n===t||r===t?!0:!1},GameUi=function(){function e(e,t,n){this.createRectActorWithBody=__bind(this.createRectActorWithBody,this),this.bodyFromActor=__bind(this.bodyFromActor,this);var r,i,s;s=e.offsetWidth,i=e.offsetHeight,this.director=(new CAAT.Director).initialize(s,i,e),this.scene=this.director.createScene(),CAAT.PMR=tjump.SCALE,CAAT.enableBox2DDebug(!0,this.director,t),this.scene.onRenderStart=n,r=45,CAAT.loop(r)}return e.prototype.bodyFromActor=function(e,t){return CAAT.B2DPolygonBody.createPolygonBody(t,{x:e.x,y:e.y,bodyType:Box2D.Dynamics.b2Body.b2_staticBody,density:1,restitution:1,friction:1,image:null,polygonType:CAAT.B2DPolygonBody.Type.BOX,bodyDef:[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y+e.height}],bodyDefScale:1,bodyDefScaleTolerance:0,userData:{}})},e.prototype.createRectActorWithBody=function(e,t){var n,r;return n=(new CAAT.Actor).setLocation(e.top,e.left).setSize(e.width,e.height).setFillStyle("orange"),r=this.bodyFromActor(n,t),r},e}(),ElementArticulator=function(){function e(){this.isValid=__bind(this.isValid,this),this.articulateElement=__bind(this.articulateElement,this)}return e.prototype.articulateElement=function(e){var t;return this.isValid(e)?(t={top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:5},tjump.createPlatform(t),!0):!1},e.prototype.isValid=function(e){return e.offsetWidth?e.offsetWidth>tjump.canvas.offsetWidth/3?!1:e.offsetHeight>tjump.canvas.offsetHeight/3?!1:e.offsetWidth<5?!1:e.offsetHeight<5?!1:!0:!1},e}(),DomParser=function(){function e(e){this.articulator=e,this.parseElement=__bind(this.parseElement,this),this.parsePage=__bind(this.parsePage,this)}return e.prototype.parsePage=function(){return this.elementCount=0,this.parseElement(document.body)},e.prototype.parseElement=function(e){var t,n,r,i,s,o;n=this.articulator.articulateElement(e),this.elementCount++;if(n)return;if(this.elementCount>3e3)return;s=e.childNodes,o=[];for(r=0,i=s.length;r<i;r++)t=s[r],o.push(this.parseElement(t));return o},e}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return window.setTimeout(e,1e3/60)}}(),tjump.createPlatform=function(e){return tjump.ui.createRectActorWithBody(e,tjump.world)},tjump.beginContact=function(e){},tjump.update=function(){return tjump.world.Step(tjump.FRAME_RATE,tjump.VELOCITY_ITERATIONS,tjump.POSITION_ITERATIONS),tjump.world.DrawDebugData(),tjump.world.ClearForces()},tjump.init=function(){var e,t,n,r;return t=Box2D.Dynamics.b2DebugDraw,e=!0,tjump.world=new Box2D.Dynamics.b2World(tjump.GRAVITY,e),tjump.elementArticulator=new ElementArticulator,tjump.domParser=new DomParser(tjump.elementArticulator),tjump.ui=new GameUi(tjump.canvas,tjump.world,tjump.update),tjump.domParser.parsePage(),r=new Box2D.Dynamics.b2ContactListener,r.BeginContact=tjump.beginContact,tjump.world.SetContactListener(r),n=new t,n.SetSprite(tjump.ctx),n.SetDrawScale(tjump.SCALE),n.SetFillAlpha(.4),n.SetLineThickness(1),n.SetFlags(t.e_shapeBit|t.e_jointBit),tjump.world.SetDebugDraw(n)},tjump.init(),requestAnimFrame(tjump.update)