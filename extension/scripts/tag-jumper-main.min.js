var BodyActor,BodyWrapper,DomParser,ElementActor,ElementArticulator,ElementWrapper,GameUi,InputHandler,Player,tj,__bind=function(t,e){return function(){return t.apply(e,arguments)}};tj={},tj.overlay=document.createElement("div"),tj.overlay.id="main-overlay",tj.overlay.className+="overlay",tj.canvas=document.createElement("canvas"),tj.canvas.id="main-canvas",tj.canvas.className+="canvas",tj.overlay.appendChild(tj.canvas),tj.ctx=tj.canvas.getContext("2d"),tj.$document=$(document),document.body.appendChild(tj.overlay),tj.SCALE=32,tj.FRAME_RATE=1/60,tj.VELOCITY_ITERATIONS=10,tj.POSITION_ITERATIONS=10,tj.GRAVITY=new Box2D.Common.Math.b2Vec2(0,10),tj.getWidth=function(){return tj.canvas.offsetWidth},tj.getHeight=function(){return tj.canvas.offsetHeight},tj.scaleToPhys=function(t){return t/tj.SCALE},tj.scaleVecToPhys=function(t){return t.Multiply(1/tj.SCALE),t},tj.scaleVecFromPhys=function(t){return t.Multiply(tj.SCALE),t},tj.scaleToScreen=function(t){return t*tj.SCALE},tj.createB2Vec=function(t,e){var o;return o=new Box2D.Common.Math.b2Vec2(t,e)},tj.createB2VecScaledToPhys=function(t,e){var o,n;return n=tj.createB2Vec(t,e),o=tj.scaleVecToPhys(n)},tj.applyXForce=function(t,e){var o,n,i;return o=Box2D.Common.Math.b2Vec2,n=t.GetPosition(),i=new o(e,0),t.ApplyForce(i,n)},tj.applyYForce=function(t,e){var o,n,i;return o=Box2D.Common.Math.b2Vec2,n=t.GetPosition(),i=new o(0,e),t.ApplyForce(i,n)},tj.isBodyInContact=function(t,e){var o,n;return o=t.GetFixtureA().GetBody(),n=t.GetFixtureB().GetBody(),o===e||n===e?!0:!1},ElementWrapper=function(){function t(t){this.element=t,this.isVisible=__bind(this.isVisible,this),this.getLocation=__bind(this.getLocation,this),this.$element=$(t)}return t.prototype.getLocation=function(){var t;return t={top:this.$element.offset().top-tj.$document.scrollTop(),left:this.$element.offset().left-tj.$document.scrollLeft(),height:this.$element.height(),width:this.$element.width()}},t.prototype.isVisible=function(){return this.$element.is(":visible")},t}(),InputHandler=function(){function t(t){var e=this;this.player=t,$("body").keydown(function(t){return e.keysDown[t.keyCode]=!0}),$("body").keyup(function(t){return delete e.keysDown[t.keyCode]})}return t.prototype.keysDown={},t.prototype.update=function(){return 38 in this.keysDown&&this.player.up(),40 in this.keysDown&&this.player.down(),37 in this.keysDown&&this.player.left(),39 in this.keysDown?this.player.right():void 0},t}(),Player=function(){function t(t){this.bodyActor=t,this.right=__bind(this.right,this),this.left=__bind(this.left,this),this.down=__bind(this.down,this),this.up=__bind(this.up,this)}return t.prototype.up=function(){var t;return t=tj.createB2Vec(0,-2),this.bodyActor.applyImpulse(t)},t.prototype.down=function(){},t.prototype.left=function(){var t;return t=tj.createB2Vec(1,0),this.bodyActor.applyImpulse(t)},t.prototype.right=function(){var t;return t=tj.createB2Vec(-1,0),this.bodyActor.applyImpulse(t)},t}(),BodyWrapper=function(){function t(t){this.body=t,this.applyImpulse=__bind(this.applyImpulse,this),this.getUiPosition=__bind(this.getUiPosition,this)}return t.prototype.getUiPosition=function(){var t,e,o;return o=this.body.worldBody.GetPosition(),e=tj.scaleVecFromPhys(o),t={x:e.x-tj.$document.scrollLeft(),y:e.y-tj.$document.scrollTop()}},t.prototype.applyImpulse=function(t){var e;return e=this.body.worldBody.GetPosition(),this.body.worldBody.ApplyImpulse(t,e)},t}(),BodyActor=function(){function t(t,e){this.bodyWrapper=t,this.actor=e,this.applyImpulse=__bind(this.applyImpulse,this),this.update=__bind(this.update,this)}return t.prototype.update=function(){var t;return t=this.bodyWrapper.getUiPosition(),this.actor.setLocation(t.x,t.y)},t.prototype.applyImpulse=function(t){return this.bodyWrapper.applyImpulse(t)},t}(),ElementActor=function(){function t(t,e,o){this.elementWrapper=t,this.actor=e,this.body=o,this.update=__bind(this.update,this)}return t.prototype.update=function(){var t;return t=this.elementWrapper.getLocation(),this.actor.setLocation(t.left,t.top)},t}(),GameUi=function(){function t(t,e,o){var n,i;this.world=e,this.createTextActor=__bind(this.createTextActor,this),this.createRectActorWithBody=__bind(this.createRectActorWithBody,this),this.rectBodyFromActor=__bind(this.rectBodyFromActor,this),this.bodyFromActor=__bind(this.bodyFromActor,this),i=t.offsetWidth,n=t.offsetHeight,this.director=(new CAAT.Director).initialize(i,n,t),this.scene=this.director.createScene(),CAAT.PMR=tj.SCALE,CAAT.enableBox2DDebug(!0,this.director,this.world),this.scene.onRenderStart=o,CAAT.loop(tj.FRAME_RATE)}return t.prototype.getDefaultBodyDef=function(t){var e;return e={x:t.x,y:t.y,bodyType:Box2D.Dynamics.b2Body.b2_staticBody,density:1,restitution:1,friction:1,image:null,polygonType:CAAT.B2DPolygonBody.Type.BOX,bodyDef:[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y+t.height}],bodyDefScale:1,bodyDefScaleTolerance:0,userData:{}}},t.prototype.createPolygon=function(t,e,o){var n;return n=(new CAAT.B2DPolygonBody).enableEvents(!1).createBody(world,{x:t,y:e,bodyType:Box2D.Dynamics.b2Body.b2_dynamicBody,density:o.density,restitution:o.restitution,friction:o.friction,image:null,polygonType:CAAT.B2DPolygonBody.Type.POLYGON,bodyDef:o.polygonDef,bodyDefScale:o.polygonScale,bodyDefScaleTolerance:o.tolerance,userData:null})},t.prototype.bodyFromActor=function(t,e){var o;return o=CAAT.B2DPolygonBody.createPolygonBody(this.world,e)},t.prototype.rectBodyFromActor=function(t){var e;return e=CAAT.B2DPolygonBody.createPolygonBody(this.world,this.getDefaultBodyDef(t))},t.prototype.createRectActorWithBody=function(t,e){var o;return this.world=e,o=(new CAAT.Actor).setLocation(t.left,t.top).setSize(t.width,t.height).setFillStyle("orange").setAlpha(.6),this.scene.addChild(o),o},t.prototype.createTextActor=function(t){var e;return e=(new CAAT.TextActor).setLocation(t.left,t.top).setText(t.text).setFillStyle("black"),this.scene.addChild(e),e},t}(),ElementArticulator=function(){function t(){this.isValid=__bind(this.isValid,this),this.articulateElement=__bind(this.articulateElement,this)}return t.prototype.articulateElement=function(t){return this.isValid(t)?.9>Math.random()?!1:(tj.createPlatform(t),!0):!1},t.prototype.isValid=function(t){return t.offsetWidth?t.offsetWidth>tj.canvas.offsetWidth/2?!1:t.offsetHeight>tj.canvas.offsetHeight/2?!1:5>t.offsetWidth?!1:5>t.offsetHeight?!1:!0:!1},t}(),DomParser=function(){function t(t){this.articulator=t,this.parseElement=__bind(this.parseElement,this),this.parsePage=__bind(this.parsePage,this)}return t.prototype.parsePage=function(){return this.elementCount=0,this.parseElement(document.body)},t.prototype.parseElement=function(t){var e,o,n,i,r,s;if(o=this.articulator.articulateElement(t),this.elementCount++,!(this.elementCount>3e4)){for(r=t.childNodes,s=[],n=0,i=r.length;i>n;n++)e=r[n],s.push(this.parseElement(e));return s}},t}(),tj.createPlatform=function(t){var e,o,n,i;return n=new ElementWrapper(t),i=n.getLocation(),e=tj.ui.createRectActorWithBody(i,tj.world),o=tj.ui.rectBodyFromActor(e),tj.updatables.push(new ElementActor(n,e,o))},tj.createPlayer=function(){var t,e,o,n,i,r,s;return r={top:200,left:200,width:10,height:20},t=tj.ui.createRectActorWithBody(r,tj.world),t.setFillStyle("green"),t.setAlpha(.8),n=tj.ui.getDefaultBodyDef(t),n.bodyType=Box2D.Dynamics.b2Body.b2_dynamicBody,e=tj.ui.bodyFromActor(t,n),i=new BodyWrapper(e),o=new BodyActor(i,t),tj.updatables.push(o),s=new Player(o)},tj.beginContact=function(){},tj.update=function(){var t,e,o,n;if(tj.initComplete){for(tj.world.Step(tj.FRAME_RATE,tj.VELOCITY_ITERATIONS,tj.POSITION_ITERATIONS),tj.world.ClearForces(),n=tj.updatables,e=0,o=n.length;o>e;e++)t=n[e],t.update();return tj.inputHandler.update()}},tj.init=function(){var t,e,o,n,i;return tj.updatables=[],e=Box2D.Dynamics.b2DebugDraw,t=!0,tj.world=new Box2D.Dynamics.b2World(tj.GRAVITY,t),tj.elementArticulator=new ElementArticulator,tj.domParser=new DomParser(tj.elementArticulator),tj.ui=new GameUi(tj.canvas,tj.world,tj.update),tj.domParser.parsePage(),n=new Box2D.Dynamics.b2ContactListener,n.BeginContact=tj.beginContact,tj.world.SetContactListener(n),i=tj.createPlayer(),tj.inputHandler=new InputHandler(i),o=new e,o.SetSprite(tj.ctx),o.SetDrawScale(tj.SCALE),o.SetFillAlpha(.4),o.SetLineThickness(1),o.SetFlags(e.e_shapeBit|e.e_jointBit),tj.initComplete=!0},tj.init();