var DomParser,ElementActor,ElementArticulator,GameUi,tjump,__bind=function(t,e){return function(){return t.apply(e,arguments)}};tjump={},tjump.overlay=document.createElement("div"),tjump.overlay.id="main-overlay",tjump.overlay.className+="overlay",tjump.canvas=document.createElement("canvas"),tjump.canvas.id="main-canvas",tjump.canvas.className+="canvas",tjump.overlay.appendChild(tjump.canvas),tjump.ctx=tjump.canvas.getContext("2d"),tjump.$document=$(document),document.body.appendChild(tjump.overlay),tjump.SCALE=32,tjump.FRAME_RATE=1/60,tjump.VELOCITY_ITERATIONS=10,tjump.POSITION_ITERATIONS=10,tjump.GRAVITY=new Box2D.Common.Math.b2Vec2(9.8,5),tjump.getWidth=function(){return tjump.canvas.offsetWidth},tjump.getHeight=function(){return tjump.canvas.offsetHeight},tjump.scaleToPhys=function(t){return t/tjump.SCALE},tjump.scaleVecToPhys=function(t){return t.Multiply(1/tjump.SCALE),t},tjump.scaleToScreen=function(t){return t*tjump.SCALE},tjump.applyXForce=function(t,e){var o,i,n;return o=Box2D.Common.Math.b2Vec2,i=t.GetPosition(),n=new o(e,0),t.ApplyForce(n,i)},tjump.applyYForce=function(t,e){var o,i,n;return o=Box2D.Common.Math.b2Vec2,i=t.GetPosition(),n=new o(0,e),t.ApplyForce(n,i)},tjump.isBodyInContact=function(t,e){var o,i;return o=t.GetFixtureA().GetBody(),i=t.GetFixtureB().GetBody(),o===e||i===e?!0:!1},ElementActor=function(){function t(t,e){this.element=t,this.actor=e,this.update=__bind(this.update,this),this.isVisible=__bind(this.isVisible,this),this.getLocation=__bind(this.getLocation,this),this.$element=$(t)}return t.prototype.getLocation=function(){var t;return t={top:this.$element.offset().top-tjump.$document.scrollTop(),left:this.$element.offset().left-tjump.$document.scrollLeft()}},t.prototype.isVisible=function(){return this.$element.is(":visible")},t.prototype.update=function(){var t;return this.isVisible()?(t=this.getLocation(),this.actor.setVisible(!0),this.actor.setLocation(t.left,t.top)):this.actor.setVisible(!1)},t}(),GameUi=function(){function t(t,e,o){var i,n;this.world=e,this.createTextActor=__bind(this.createTextActor,this),this.createRectActorWithBody=__bind(this.createRectActorWithBody,this),this.rectBodyFromActor=__bind(this.rectBodyFromActor,this),this.bodyFromActor=__bind(this.bodyFromActor,this),n=t.offsetWidth,i=t.offsetHeight,this.director=(new CAAT.Director).initialize(n,i,t),this.scene=this.director.createScene(),CAAT.PMR=tjump.SCALE,CAAT.enableBox2DDebug(!0,this.director,this.world),this.scene.onRenderStart=o,CAAT.loop(tjump.FRAME_RATE)}return t.prototype.getDefaultBodyDef=function(t){var e;return e={x:t.x,y:t.y,bodyType:Box2D.Dynamics.b2Body.b2_staticBody,density:1,restitution:1,friction:1,image:null,polygonType:CAAT.B2DPolygonBody.Type.BOX,bodyDef:[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y+t.height}],bodyDefScale:1,bodyDefScaleTolerance:0,userData:{}}},t.prototype.bodyFromActor=function(t,e){var o;return o=CAAT.B2DPolygonBody.createPolygonBody(this.world,e)},t.prototype.rectBodyFromActor=function(t){var e;return e=CAAT.B2DPolygonBody.createPolygonBody(this.world,this.getDefaultBodyDef(t))},t.prototype.createRectActorWithBody=function(t,e){var o;return this.world=e,o=(new CAAT.Actor).setLocation(t.left,t.top).setSize(t.width,t.height).setFillStyle("orange").setAlpha(.6),this.scene.addChild(o),o},t.prototype.createTextActor=function(t){var e;return e=(new CAAT.TextActor).setLocation(t.left,t.top).setText(t.text).setFillStyle("black"),this.scene.addChild(e),e},t}(),ElementArticulator=function(){function t(){this.isValid=__bind(this.isValid,this),this.articulateElement=__bind(this.articulateElement,this)}return t.prototype.articulateElement=function(t){return this.isValid(t)?.9>Math.random()?!1:(tjump.createPlatform(t),!0):!1},t.prototype.isValid=function(t){return t.offsetWidth?t.offsetWidth>tjump.canvas.offsetWidth/2?!1:t.offsetHeight>tjump.canvas.offsetHeight/2?!1:5>t.offsetWidth?!1:5>t.offsetHeight?!1:!0:!1},t}(),DomParser=function(){function t(t){this.articulator=t,this.parseElement=__bind(this.parseElement,this),this.parsePage=__bind(this.parsePage,this)}return t.prototype.parsePage=function(){return this.elementCount=0,this.parseElement(document.body)},t.prototype.parseElement=function(t){var e,o,i,n,r,a;if(o=this.articulator.articulateElement(t),this.elementCount++,!(this.elementCount>3e4)){for(r=t.childNodes,a=[],i=0,n=r.length;n>i;i++)e=r[i],a.push(this.parseElement(e));return a}},t}(),tjump.createPlatform=function(t){var e,o,i;return i={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight},e=tjump.ui.createRectActorWithBody(i,tjump.world),o=tjump.ui.rectBodyFromActor(e),tjump.updatables.push(new ElementActor(t,e))},tjump.createPlayer=function(){var t,e,o,i;return i={top:200,left:200,width:10,height:20},t=tjump.ui.createRectActorWithBody(i,tjump.world),t.setFillStyle("green"),t.setAlpha(.8),o=tjump.ui.getDefaultBodyDef(t),o.bodyType=Box2D.Dynamics.b2Body.b2_dynamicBody,e=tjump.ui.bodyFromActor(t,o),tjump.updatables.push(new ElementActor(element,t))},tjump.beginContact=function(){},tjump.update=function(){var t,e,o,i,n;for(tjump.world.Step(tjump.FRAME_RATE,tjump.VELOCITY_ITERATIONS,tjump.POSITION_ITERATIONS),tjump.world.ClearForces(),i=tjump.updatables,n=[],e=0,o=i.length;o>e;e++)t=i[e],n.push(t.update());return n},tjump.init=function(){var t,e,o,i;return tjump.updatables=[],e=Box2D.Dynamics.b2DebugDraw,t=!0,tjump.world=new Box2D.Dynamics.b2World(tjump.GRAVITY,t),tjump.elementArticulator=new ElementArticulator,tjump.domParser=new DomParser(tjump.elementArticulator),tjump.ui=new GameUi(tjump.canvas,tjump.world,tjump.update),tjump.domParser.parsePage(),i=new Box2D.Dynamics.b2ContactListener,i.BeginContact=tjump.beginContact,tjump.world.SetContactListener(i),tjump.createPlayer(),setup(debug(draw)),o=new e,o.SetSprite(tjump.ctx),o.SetDrawScale(tjump.SCALE),o.SetFillAlpha(.4),o.SetLineThickness(1),o.SetFlags(e.e_shapeBit|e.e_jointBit),tjump.world.SetDebugDraw(o)},tjump.init();